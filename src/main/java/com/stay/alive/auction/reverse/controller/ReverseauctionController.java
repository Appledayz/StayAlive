package com.stay.alive.auction.reverse.controller;

import java.util.HashMap;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;

import com.stay.alive.auction.reverse.service.ReverseauctionService;
import com.stay.alive.auction.reverse.service.ReverseauctionSuccessfulbidService;
import com.stay.alive.auction.reverse.service.ReverseauctionTenderService;
import com.stay.alive.auction.reverse.vo.Reverseauction;
import com.stay.alive.common.PageMaker;

@Controller
@RequestMapping("auction/reverse")
public class ReverseauctionController {
	@Autowired
	private ReverseauctionService reverseauctionService;
	@Autowired
	private ReverseauctionTenderService reverseauctionTenderService;
	@Autowired
	private ReverseauctionSuccessfulbidService reverseauctionSuccessfulbidService;
	private PageMaker pageMaker;
	
	// 1. 역경매목록 조회
	@GetMapping("listAll")
	public String reverseauctionList(Model model, @RequestParam(value="page", defaultValue="1")int page,
												  @RequestParam HashMap<String, String> paraMap) {
		System.out.println("ReverseauctionController.reverseauctionList() GET");
		pageMaker = new PageMaker();
		pageMaker.setCurrentPage(page);
		model.addAttribute("list", reverseauctionService.getReverseauctionList(pageMaker));
		model.addAttribute("PM", pageMaker);
		return "/reverseauction/reverseauctionList";
	}
	// 2. 역경매목록 검색
	@GetMapping("list")
	public String reverseauctionSearchList(Model model, @RequestParam(value="page", defaultValue="1")int page,
														@RequestParam HashMap<String, String> paraMap) {
		System.out.println("ReverseauctionController.reverseauctionList() GET");
		pageMaker = new PageMaker();
		pageMaker.setCurrentPage(page);
		String date1 = paraMap.get("date1");
		String date2 = paraMap.get("date2");
		String sk = paraMap.get("sk");                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   
		String sv = paraMap.get("sv");
		if(date1 == "") {
			date1 = null;
		}
		if(date2 == "") {
			date2 = null;
		}	
		model.addAttribute("list", reverseauctionService.getReverseauctionSearchList(pageMaker, sk, sv, date1, date2));
		model.addAttribute("PM", pageMaker);
		model.addAttribute("sk", sk);
		model.addAttribute("sv", sv);
		return "/reverseauction/reverseauctionList";
	}
	// 3. 역경매 등록 폼
	@GetMapping("add")
	public String addReverseauction() {
		System.out.println("ReverseauctionController.addReverseauction() GET");
		return "/reverseauction/addReverseauction";
	}
	// 4. 역경매 등록 액션
	@PostMapping("add")
	public String addReverseauction(Reverseauction reverseauction) {
		System.out.println("ReverseauctionController.addReverseauction() POST");
		reverseauctionService.addReverseauctionOne(reverseauction);
		return "redirect:/auction/reverse/list";
	}
	// 5. 역경매 상세 조회
	@GetMapping("detail")
	public String reverseauctionDetail(Model model, int reverseauctionNo) {
		System.out.println("ReverseauctionController.reverseauctionDetail() GET");
		model.addAttribute("m",reverseauctionService.getReverseauctionOne(reverseauctionNo));
		model.addAttribute("m2", reverseauctionTenderService.getTenderListForOneReverseauction(reverseauctionNo));
		model.addAttribute("m3", reverseauctionSuccessfulbidService.getReverseauctionSuccessfulbid(reverseauctionNo));
		return "/reverseauction/reverseauctionDetail";
	}
	// 6. 역경매 수정 폼
	@GetMapping("modify")
	public String modifyReverseauction(Model model, int reverseauctionNo) {
		System.out.println("ReverseauctionController.modifyReverseauction() GET");
		model.addAttribute("Reverseauction",reverseauctionService.modifyReverseauctionForm(reverseauctionNo));
		return "/reverseauction/modifyReverseauction";
	}
	// 7. 역경매 수정 액션
	@PostMapping("modify")
	public String modifyReverseauction(Reverseauction reverseauction) {
		System.out.println("ReverseauctionController.modifyReverseauction() POST");
		reverseauctionService.modifyReverseauctionAction(reverseauction);
		return "redirect:/auction/reverse/detail?reverseauctionNo="+reverseauction.getReverseauctionNo();
	}
	// 8. 역경매 삭제
	@GetMapping("remove")
	public String deleteReverseauction(int reverseauctionNo) {
		System.out.println("ReverseauctionController.deleteReverseauction() GET");
		System.out.println(reverseauctionService.removeReverseauction(reverseauctionNo));
		return "redirect:/auction/reverse/list";
	}
	
}
