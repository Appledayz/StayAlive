<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Core Stylesheet -->
    <link rel="stylesheet" href="/main/style.css">
    <!-- jQuery-2.2.4 js -->
    <script src="/main/js/jquery/jquery-2.2.4.min.js"></script>
    <script>
    	//url에서 get parameter value 구하는 함수
	    function getQuerystring(name){
	    	let _tempUrl = location.search.substring(1);
			let _tempArray = _tempUrl.split('&');
			for(let i = 0; i<_tempArray.length; i++) {
				let _keyValuePair = _tempArray[i].split('=');
				if(_keyValuePair[0] == name){
					return _keyValuePair[1];
				}
			}
		}
	    if(getQuerystring('fail')=='true'){
	    	alert('낙찰실패 : 이미낙찰상태인지 확인해주세요');
	    }
	    function check(elem){
 			let result = confirm('Are you sure?');
 			if(result){
 				elem.parentElement.submit();
 			}
	    }
	  	$(function() {
	  		$('#theModal').on('show.bs.modal', function (e) {
	  			$('.modal-body').empty();
	  			let button = $(e.relatedTarget);
	  			let modalbody = $('.modal-body');
	  		  	$.ajax({
	  		  		url : "/accommodation/detail",
	  		  		data : {"accommodationNo" : button.data("remote")},
	  		  		type: 'GET',
	  				contentType:"application/x-www-form-urlencoded",
	  				success: (data)=>{
	  					modalbody.append($('<p></p>').text('accommodationNo : '+data.accommodationNo));
	  					modalbody.append($('<p></p>').text('accommodationName : '+data.accommodationName));
	  					$.ajax({
	  			  			url : "/auction/reverse/tender/accommodationImg",
	  			  			data : {"accommodationNo" : data.accommodationNo},
	  			  			type : "GET",
	  		  				contentType:"application/x-www-form-urlencoded",
	  						success: (data)=>{
	  							modalbody.append('<p> imageFilePath : '+data.imageFilePath+'</p>');
	  						}
	  			  		});
	           	    }
	  		  	});
	  		});
	  	});
    </script>
	<title>AuctionDetail</title>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader d-flex align-items-center justify-content-center">
        <div class="cssload-container">
            <div class="cssload-loading"><i></i><i></i><i></i><i></i></div>
        </div>
    </div>
    
    <!-- 모달  -->
	<div class="modal fade" id="theModal" tabindex="-1" role="dialog">
	    <div class="modal-dialog modal-lg" >
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="modalLabel">My modal</h5>
	                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                    <span aria-hidden="true">×</span>
	                </button>
	            </div> 
	            <div class="modal-body">
					
				</div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	            </div>
	        </div>
	    </div>
	</div>
	
	<!-- header replace -->
    <div th:replace="header :: header"></div>

    <!-- ##### Breadcumb Area Start ##### -->
    <section class="breadcumb-area bg-img d-flex align-items-center justify-content-center" style="background-image: url(/main/img/bg-img/bg-6.jpg);">
        <div class="bradcumbContent">
            <h2>AuctionDetail</h2>
        </div>
    </section>
    <!-- ##### Breadcumb Area End ##### -->
	
	<section class="contact-form-area mb-100">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<div class="section-heading">
						<div class="line-"></div>
						<h2>역경매 상세</h2>
					</div>
				</div>
			</div>
			<div class="row justify-content-center">
				<div class="col-lg-8">
					<div class="section-heading text-center">
						<div class="line-"></div>
						<h2 th:text="${m.reverseauctionTitle}">역경매 제목</h2>
						<p th:text="${m.reverseauctionContent}">역경매 내용</p>
						<p th:text="'조회수 : '+${m.reverseauctionHits}" style="margin-top:1em;">조회수</p>
						<p th:text="'등록일 : '+${m.reverseauctionRegisterDate}">역경매 등록일</p>
						<p th:if="${m.reverseauctionUpdateDate!=null}" th:text="'수정일 : '+${m.reverseauctionUpdateDate}">역경매 등록일</p>
						<a th:href="@{/auction/reverse/modify(reverseauctionNo=${m.reverseauctionNo})}" class="btn palatin-btn mt-50">역경매수정하기</a>
						<a th:href="@{/auction/reverse/remove(reverseauctionNo=${m.reverseauctionNo})}" class="btn palatin-btn mt-50">역경매삭제하기</a>
					</div>
				</div>
				<div class="col-lg-4">
                    <div class="about-thumbnail mb-100">
                    	<table class="table table-striped table-bordered table-hover">
                    		<tr><td>Trevelers</td></tr>
                    		<tr><td th:text="${m.reverseauctionNumberOfPeople}">Trevelers</td></tr>
                    		<tr><td>Price</td></tr>
                    		<tr><td th:text="'￦'+${m.reverseauctionTenderLimit}+'↓'">Price</td></tr>
                    		<tr><td>Going to</td></tr>
                    		<tr><td th:text="${m.reverseauctionAddress}">Going to</td></tr>
                    		<tr><td>Check-in</td>
                    		<td>Check-out</td></tr>
                    		<tr><td th:text="${m.reverseauctionRoomingDate}">Check-in</td>
                    		<td th:text="${m.reverseauctionLeavingDate}">Check-out</td></tr>
                    	</table>
                    </div>
                </div>
			</div>
			<div class="row">
				<div class="col-lg-2">
					<div class="section-heading text-center">
						<div class="line-"></div>
						<h2>입찰</h2>
						<a th:href="@{/auction/reverse/tender/add(reverseauctionNo=${m.reverseauctionNo})}" class="btn palatin-btn mt-50">역경매 입찰</a>
					</div>
				</div>
				<div class="col-lg-10" style="background-color:rgb(50,50,50); border:2px solid rgb(203, 134, 112)">
					<div style="display: flex; flex-direction: column;">
						<div th:each="tender : ${m2}" style="background-color:rgba(100,100,100,0.2); border:1px solid rgb(203, 134, 112); margin: 10px 0; padding:5px;">
							<p th:text="${tender.reverseauctionTenderNo}"></p>
							<button class="btn btn-primary" data-toggle="modal" data-target="#theModal" th:attr="data-remote=${tender.accommodationNo}">숙소상세보기</button>
							<form action="/auction/reverse/successfulbid/add" method="get">
								<input type="hidden" th:name="reverseauctionTenderNo" th:value="${tender.reverseauctionTenderNo}">
								<input type="hidden" th:name="reverseauctionNo" th:value="${tender.reverseauctionNo}">
								<button type="button" class="btn SuccessfulbidBtn" onclick="check(this)" th:text="낙찰">낙찰</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- 
	<h1>ReverseauctionDetail</h1>
	<table class="table table-striped table-bordered table-hover">
		<tbody>
			<tr>
				<td>No</td>
				<td th:text="${m.reverseauctionNo}"></td>
			</tr>
			<tr>
				<td>memberId</td>
				<td th:text="${m.memberId}"></td>
			</tr>
			<tr>
				<td>RegisterDate</td>
				<td th:text="${m.reverseauctionRegisterDate}"></td>
			</tr>
			<tr>
				<td>UpdateDate</td>
				<td th:text="${m.reverseauctionUpdateDate}"></td>
			</tr>
			<tr>
				<td>TenderLimit</td>
				<td th:text="${m.reverseauctionTenderLimit}"></td>
			</tr>
			<tr>
				<td>TendercloseDate</td>
				<td th:text="${m.reverseauctionTendercloseDate}"></td>
			</tr>
			<tr>
				<td>RoomingDate</td>
				<td th:text="${m.reverseauctionRoomingDate}"></td>
			</tr>
			<tr>
				<td>LeavingDate</td>
				<td th:text="${m.reverseauctionLeavingDate}"></td>
			</tr>
			<tr>
				<td>NumberOfPeople</td>
				<td th:text="${m.reverseauctionNumberOfPeople}"></td>
			</tr>
			<tr>
				<td>Title</td>
				<td th:text="${m.reverseauctionTitle}"></td>
			</tr>
			<tr>
				<td>Address</td>
				<td th:text="${m.reverseauctionAddress}"></td>
			</tr>
			<tr>
				<td>AddressMore</td>
				<td th:text="${m.reverseauctionAddressMore}"></td>
			</tr>
			<tr>
				<td>Hits</td>
				<td th:text="${m.reverseauctionHits}"></td>
			</tr>
			<tr>
				<td>Content</td>
				<td th:text="${m.reverseauctionContent}"></td>
			</tr>
			<tr>
				<td>TenderCount</td>
				<td th:text="${m.reverseauctionTenderCount}"></td>
			</tr>
			<tr>
				<td>auctionStateCategoryNo</td>
				<td th:text="${m.auctionStateCategoryNo}"></td>
			</tr>
			<tr>
				<td>auctionStateCategoryName</td>
				<td th:text="${m.auctionStateCategoryName}"></td>
			</tr>
		</tbody>
	</table> -->

	<!-- <h1>입찰목록</h1>
	<table class="table table-striped table-bordered table-hover">
		<tbody>
			<tr>
				<td>reverseauctionTenderNo</td>
				<td>memberId</td>
				<td>companyNo</td>
				<td>companyName</td>
				<td>accommodationNo</td>
				<td>accommodationName</td>
				<td>guestroomNo</td>
				<td>guestroomName</td>
				<td>reverseauctionNo</td>
				<td>accommodationGuestroomAllcount</td>
				<td>guestroomStateCount</td>
				<td>reverseauctionTenderDate</td>
				<td>reverseauctionTenderUpdateDate</td>
				<td>reverseauctionTenderContent</td>
				<td>reverseauctionTenderPirce</td>
				<td>auctionStateCategoryNo</td>
				<td>auctionStateCategoryName</td>
			</tr>
			<tr th:each="item: ${m2}">
				<td th:text="${item.reverseauctionTenderNo}"></td>
				<td th:text="${item.memberId}"></td>
				<td th:text="${item.companyNo}"></td>
				<td th:text="${item.companyName}"></td>
				<td th:text="${item.accommodationNo}"></td>
				<td th:text="${item.accommodationName}"></td>
				<td th:text="${item.guestroomNo}"></td>
				<td th:text="${item.guestroomName}"></td>
				<td th:text="${item.reverseauctionNo}"></td>
				<td th:text="${item.accommodationGuestroomAllcount}"></td>
				<td th:text="${item.guestroomStateCount}"></td>
				<td th:text="${item.reverseauctionTenderDate}"></td>
				<td th:text="${item.reverseauctionTenderUpdateDate}"></td>
				<td th:text="${item.reverseauctionTenderContent}"></td>
				<td th:text="${item.reverseauctionTenderPrice}"></td>
				<td th:text="${item.auctionStateCategoryNo}"></td>
				<td th:text="${item.auctionStateCategoryName}"></td>
				<td><a th:href="@{removeReverseauctionTender(reverseauctionTenderNo=${item.reverseauctionTenderNo},reverseauctionNo=${item.reverseauctionNo})}" th:text="DELETE"></a></td>
				<td>
					<form action="addReverseauctionSuccessfulbid" id="successfulbidForm" method="get">
						<input type="hidden" th:name="reverseauctionTenderNo" th:value="${item.reverseauctionTenderNo}">
						<input type="hidden" th:name="reverseauctionNo" th:value="${item.reverseauctionNo}">
						<button type="button" id="SuccessfulbidBtn" th:text="SELECT"></button>
					</form>
				</td>
			</tr>
		</tbody>
	</table> -->
	
	<!-- <h1>낙찰DB</h1>
	<table class="table table-striped table-bordered table-hover">
		<tbody>
			<tr>
				<td>reverseauctionSuccessfulbidNo</td>
				<td>reverseauctionNo</td>
				<td>reverseauctionTenderNo</td>
				<td>guestroomOptionNo</td>
				<td>guestroomAdditionalPrice</td>
				<td>reverseauctionSuccessfulbidPrice</td>
				<td>reverseauctionSuccessfulbidDate</td>
				<td>reverseauctionRoomingDate</td>
				<td>reverseauctionLeavingDate</td>
				<td>auctionStateCategoryNo</td>
				<td>auctionStateCategoryName</td>
			</tr>
			<tr th:each="item : ${m3}">
				<td th:text="${item.reverseauctionSuccessfulbidNo}"></td>
				<td th:text="${item.reverseauctionNo}"></td>
				<td th:text="${item.reverseauctionTenderNo}"></td>
				<td th:text="${item.guestroomOptionNo}"></td>
				<td th:text="${item.guestroomAdditionalPrice}"></td>
				<td th:text="${item.reverseauctionSuccessfulbidPrice}"></td>
				<td th:text="${item.reverseauctionSuccessfulbidDate}"></td>
				<td th:text="${item.reverseauctionRoomingDate}"></td>
				<td th:text="${item.reverseauctionLeavingDate}"></td>
				<td th:text="${item.auctionStateCategoryNo}"></td>
				<td th:text="${item.auctionStateCategoryName}"></td>
				<td><a th:href="@{removeReverseauctionSuccessfulbid(reverseauctionNo=${item.reverseauctionNo},reverseauctionSuccessfulbidNo=${item.reverseauctionSuccessfulbidNo})}" th:text="DELETE"></a></td>
			</tr>
		</tbody>
	</table> -->
	
	<!-- footer replace -->
    <div th:replace="footer :: footer"></div>
    
    <!-- Popper js -->
    <script src="/main/js/bootstrap/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="/main/js/bootstrap/bootstrap.min.js"></script>
    <!-- All Plugins js -->
    <script src="/main/js/plugins/plugins.js"></script>
    <!-- Active js -->
    <script src="/main/js/active.js"></script>
</body>
</html>